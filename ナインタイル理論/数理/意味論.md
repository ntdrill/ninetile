# ナインタイル論理体系（改訂版）
## 0. 前提定義（Semantics）
この体系において使用される用語と概念を以下のように定義する。
**0.1 空間（Space）**
$3 \times 3$ の二次元配列を「盤面」と呼ぶ。盤面には固定された9つの「位置」が存在する。
**0.2 物体（Objects）**
物理的に区別可能な9枚の「カード」が存在する。これを $C_1, C_2, \dots, C_9$ とする（カードIDの固定）。
各カードは表（0）と裏（1）という2つの「面」を持ち、それぞれ異なる「マーク」が描かれている。
**0.3 状態（State）**
「状態」とは、9枚のカードが盤面のどの位置にあり、かつどちらの面を向いているかの確定的な記述である。
状態の総数は $9! \times 2^9$ である。
**0.4 像（Image / Topic）**
「お題」とは、盤面の各位置におけるマークの配列である。
これはカードの物理的な配置（どのカードがどこにあるか）を問わず、**表面上のマークの一致のみ**を要求する。
**0.5 操作（Operation）**
**フリップ**: 任意の位置にあるカードの面（0/1）を反転させる。
**スワップ**: 任意の2つの位置にあるカードを入れ替える。
---
## 1. 世界の構造
**1** ナインタイルとは、初期状態から目標となる像（お題）を満たす状態へと、操作を通じて到達するゲームである。
**1.1** お題はマークの配列であり、カードの内部状態（ビット）とは区別される。
**1.2** お題の生成には以下の制約が存在する。
**1.21** マークは6種類存在する。
**1.22** 1種類につき0個から2個まで表示される（合計9個）。
**1.23** この制約により、お題のマーク構成（多重集合）は以下の2つの「型」のいずれかに分類される。
**1.231** **型X**: (2, 2, 2, 2, 1, 0) - 4種が2個ずつ、1種が1個、1種が0個。
**1.232** **型Y**: (2, 2, 2, 1, 1, 1) - 3種が2個ずつ、3種が1個ずつ。
**1.3** 制約<1.2>を満たす有効なお題（像）の総数は、分類の粒度によって異なる。
**1.31** カードの表裏（ビットパターン）のみに着目した場合、有効なお題は176通りである。
**1.311** もし<1.22>の制約を無視した場合、理論上の像は512通り存在する。
**1.32** 盤面上の具体的な配置（位置）まで区別して数え上げた場合、その総数は1,587,600通りとなる。
**1.321** その内訳は、型Xに属するものが680,400通り、型Yに属するものが907,200通りである。
## 2. 表現と事実
**2** ひとつの「お題」に対し、それを満たす「0.3 状態」は複数存在する。
**2.1** カードは有限の表現力を持つが、その組み合わせ（状態）は多義的である。
**2.11** あるお題 $T$ を満たす状態の集合を $S_T$ とする。
**2.12** どのような有効なお題 $T$ に対しても、集合 $S_T$ は空ではない（必ず解が存在する）。
**2.2** 集合 $S_T$ の要素数（解のバリエーション）は、お題によって異なり、32通り、40通り、あるいは48通りである。
**2.21** したがって、お題を満たす状態がただ一つしか存在しない（一意である）という事態は起こり得ない。
## 3. 変換と操作
**3** ナインタイルのプレイとは、ある状態 $s_{start}$ から、別のお題 $T_{goal}$ を満たす任意の到達点 $s_{goal} \in S_{T_{goal}}$ への変換である。
**3.1** 任意の2つの状態間には、-0.5 操作-による変換が存在する。
**3.2** この変換は、スワップ操作（位置の置換）とフリップ操作（面の反転）の合成によって記述される。
**3.21** どのような変換も、スワップ操作のみで位置を合わせ、その後にフリップ操作を行うことで達成可能であるとみなせる。
## 4. 操作の限界（計算量的真理）
**4** 状態間の距離は、必要なスワップ回数によって測ることができる。
**4.1** 物理的なカード（物体）の配置換えは、数学的には置換群 $S_9$ の要素である。
**4.11** 任意の置換をスワップ（互換）で実現する場合、最大で8回の操作が必要となる場合がある（長さ9の巡回置換など）。
**4.2** しかし、ゲームの目的は「特定のお題を満たすこと」であり、「特定のカード配置にすること」ではない。
**4.3** プレイヤーは、到達点 $s_{goal}$ を集合 $S_{T_{goal}}$ の中から自由に選択できる（**選択の自由**）。
**4.31** プレイヤーは、現在の状態から最もスワップ回数が少なくて済むような $s_{goal}$ を選ぶことができる。
**4.4** 任意の初期状態と任意のお題に対し、スワップ回数が5回以下で済むような到達点が必ず存在する。（直感的予想）
**4.41** したがって、ナインタイルにおいて6回以上のスワップを必要とする局面は存在しない。
**4.42** これは<1.2>の制約下にある176通りのお題すべてにおいて確認された事実であり、また158万通りの「位置まで区別したお題」のサンプル検証においても確認された事実である。
**5** 結論
**5.1** ナインタイルは、有限の操作によって必ず解に到達できる決定論的な系である。
**5.2** その操作コストの上限は、スワップ5回＋フリップ9回である。
