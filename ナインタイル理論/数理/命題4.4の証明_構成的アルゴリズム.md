# 命題4.4の構成的証明（アルゴリズム）

## 目的
命題4.4「任意の初期状態と任意のお題に対し、スワップ回数が5回以下で済むような到達点が必ず存在する」を、具体的な構成手順（アルゴリズム）として証明する。
また、このアルゴリズムにより「最小保証回数（5回以下）でのスワップ手順」が**演繹的に導出可能である**ことを示す。

## 定義
- **初期配置 `f0`**: 位置 `P={p1..p9}` からカード `E={e1..e9}` への全単射。
- **目標お題 `t`**: 位置 `P` からマーク集合 `V` への写像。
- **到達点 `f1`**: お題 `t` を満たす配置（`f1(p)` の端点が `t(p)` を含む）。
- **スワップ回数**: `9 - #cycles(f0^{-1} ∘ f1)`。
- **目標**: `min_{f1 ∈ S_t} (9 - #cycles) ≤ 5`、すなわち `max_{f1 ∈ S_t} #cycles ≥ 4` を達成する `f1` を構成する。

---

## アルゴリズム：スワップ手順の演繹的導出

このアルゴリズムは、貪欲法（探索）ではなく、**目標配置の構成とサイクル分解**によってスワップ手順を一意に定める。

### Step 1: 目標配置 `f1` の決定（サイクル数最大化）
お題 `t` と初期配置 `f0` に対し、`S_t`（正当な到達点）の中で  
`#cycles(f0^{-1} ∘ f1)` を最大化する `f1*` を**全列挙で決定**する。

1. **列挙**: `S_t` の全ての `f1` を列挙する（= 正当な割当の全探索）。  
2. **最大化**: `#cycles(f0^{-1} ∘ f1)` を最大化する `f1*` を選ぶ。  
3. **最小性の保証**: スワップ回数は `9 - #cycles` なので、  
   この `f1*` は **最小スワップ回数**の到達点を与える。

### Step 2: スワップ手順の生成（サイクル分解）
決定した `f1` に対し、初期配置 `f0` からの置換 `π = f0^{-1} ∘ f1` を考える。
この `π` を互いに素な巡回置換（サイクル）の積に分解する。

`π = C_1 ∘ C_2 ∘ ... ∘ C_k`

各サイクル `C_i = (p_1 p_2 ... p_m)` に対し、以下のスワップ列を生成する：
`Swap(p_1, p_m), Swap(p_1, p_{m-1}), ..., Swap(p_1, p_2)`

この操作列は `C_i` を実現し、その回数は `m-1` 回である。
全スワップ回数は `Σ(m_i - 1) = 9 - k` となる。

### Step 3: 手順の実行（導出完了）
Step 2 で生成されたスワップ列（順序はサイクル間で自由、サイクル内は固定）が、
求める「最低保証回数でのプレイ完了手順」である。

---

## 結論
本アルゴリズムは、**「とりあえずスワップして近づける（貪欲法）」ではなく**、
**「まずゴール `f1` を計算で確定させ、そこへの最短パス（サイクル分解）を生成する」**
という演繹的な手順である。

検証事実（全パターンでサイクル数4以上の解が存在する）により、  
この手順で生成されるスワップ回数は必ず5回以下に収まることが保証される。  
また `f1*` は `#cycles` を最大化しているため、得られるスワップ回数は**最小**である。
